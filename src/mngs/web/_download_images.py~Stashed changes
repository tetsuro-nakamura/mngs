#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Timestamp: "2025-02-27 13:04:03 (ywatanabe)"
# File: /home/ywatanabe/proj/mngs_repo/src/mngs/web/_download_images.py

__file__ = "./src/mngs/web/_download_images.py"

import requests
from bs4 import BeautifulSoup
import os
import time

def download_images(url, save_folder, n_images=20):
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')
    images = soup.find_all('img')[:n_images]

    if not os.path.exists(save_folder):
        os.makedirs(save_folder)

    for i, img in enumerate(images):
        img_url = img.get('src')
        if img_url:
            try:
                img_data = requests.get(img_url).content
                timestamp = int(time.time() * 1000)
                with open(f'{save_folder}/image_{timestamp}.jpg', 'wb') as f:
                    f.write(img_data)
                print(f'Downloaded image {i}')
                time.sleep(0.1)  # Add small delay to ensure unique timestamps
            except Exception as e:
                print(f'Failed to download image {i}: {e}')

def main():
    base_query = input("Enter base search query: ")
    save_folder = f"/tmp/downloaded_images/{base_query.replace(' ', '+')}"
    width = 400
    n_images = 20

    for query_var in QUERY_VARIABLES:
        query = f"{base_query} {query_var}"
        url = f"https://www.google.com/search?q={query}&tbm=isch&tbs=isz:ex,iszw:{width}"
        print(f"Downloading images for query: {query}")
        download_images(url, save_folder, n_images)


# def main():
#     query = input("Enter search query: ")
#     width = 400
#     url = f"https://www.google.com/search?q={query}&tbm=isch&tbs=isz:ex,iszw:{width}"
#     save_folder = f"/tmp/downloaded_images/{query.replace(' ', '+')}"
#     download_images(url, save_folder)


if __name__ == "__main__":
    main()

# EOF